import { useControllableState } from '../../react-use-controllable-state/dist/index.module.js';
import { useCallbackRef } from '../../react-use-callback-ref/dist/index.module.js';
import { Primitive } from '../../react-primitive/dist/index.module.js';
import { useId } from '../../react-id/dist/index.module.js';
import { createContext } from '../../react-context/dist/index.module.js';
import { useComposedRefs } from '../../react-compose-refs/dist/index.module.js';
import { createCollection } from '../../react-collection/dist/index.module.js';
import { composeEventHandlers } from '../../primitive/dist/index.module.js';
import * as React from 'react';
import _extends from '../../../@babel/runtime/helpers/esm/extends.js';

const f={bubbles:!1,cancelable:!0},[l,m,p,d]=createCollection(),[v,g]=createContext("RovingFocusGroup");const RovingFocusGroup=/*#__PURE__*/React.forwardRef(((e,t)=>/*#__PURE__*/React.createElement(l,null,/*#__PURE__*/React.createElement(m,null,/*#__PURE__*/React.createElement(w,_extends({},e,{ref:t}))))));const w=/*#__PURE__*/React.forwardRef(((o,n)=>{const{orientation:a,dir:l="ltr",loop:m=!1,currentTabStopId:p,defaultCurrentTabStopId:g,onCurrentTabStopIdChange:w,onEntryFocus:b,...F}=o,E=React.useRef(null),I=useComposedRefs(n,E),[R=null,h]=useControllableState({prop:p,defaultProp:g,onChange:w}),[T,A]=React.useState(!1),y=useCallbackRef(b),{getItems:D}=d(),S=React.useRef(!1);return React.useEffect((()=>{const e=E.current;if(e)return e.addEventListener("rovingFocusGroup.onEntryFocus",y),()=>e.removeEventListener("rovingFocusGroup.onEntryFocus",y)}),[y]),/*#__PURE__*/React.createElement(v,{orientation:a,dir:l,loop:m,currentTabStopId:R,onItemFocus:React.useCallback((e=>h(e)),[h]),onItemShiftTab:React.useCallback((()=>A(!0)),[])},/*#__PURE__*/React.createElement(Primitive.div,_extends({tabIndex:T?-1:0,"aria-orientation":a,"data-orientation":a},F,{ref:I,style:{outline:"none",...o.style},onMouseDown:composeEventHandlers(o.onMouseDown,(()=>{S.current=!0;})),onFocus:composeEventHandlers(o.onFocus,(e=>{const t=!S.current;if(e.target===e.currentTarget&&t&&!T){const t=new Event("rovingFocusGroup.onEntryFocus",f);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=D().filter((e=>e.focusable));x([e.find((e=>e.active)),e.find((e=>e.id===R)),...e].filter(Boolean).map((e=>e.ref.current)));}}S.current=!1;})),onBlur:composeEventHandlers(o.onBlur,(()=>A(!1)))})))}));const RovingFocusItem=/*#__PURE__*/React.forwardRef(((e,t)=>{const{focusable:n=!0,active:i=!1,...a}=e,f=useId(),l=g("RovingFocusItem"),m=l.currentTabStopId===f,{getItems:v}=d();return React.createElement(p,{id:f,focusable:n,active:i},/*#__PURE__*/React.createElement(Primitive.span,_extends({tabIndex:m?0:-1,"data-orientation":l.orientation},a,{ref:t,onMouseDown:composeEventHandlers(e.onMouseDown,(e=>{n?l.onItemFocus(f):e.preventDefault();})),onFocus:composeEventHandlers(e.onFocus,(()=>l.onItemFocus(f))),onKeyDown:composeEventHandlers(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void l.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,r){const o=function(e,t){return "rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,r);return "vertical"===t&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)?void 0:b[o]}(e,l.orientation,l.dir);if(void 0!==t){e.preventDefault();let n=v().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const i=n.indexOf(e.currentTarget);n=l.loop?(o=i+1,(r=n).map(((e,t)=>r[(o+t)%r.length]))):n.slice(i+1);}setTimeout((()=>x(n)));}var r,o;}))})))}));const b={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function x(e){const t=document.activeElement;for(const r of e){if(r===t)return;if(r.focus(),document.activeElement!==t)return}}

export { RovingFocusGroup, RovingFocusItem };
