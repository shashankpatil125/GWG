import { useEscapeKeydown } from '../../react-use-escape-keydown/dist/index.module.js';
import { useCallbackRef } from '../../react-use-callback-ref/dist/index.module.js';
import { useBodyPointerEvents } from '../../react-use-body-pointer-events/dist/index.module.js';
import { Primitive } from '../../react-primitive/dist/index.module.js';
import { composeEventHandlers } from '../../primitive/dist/index.module.js';
import * as React from 'react';
import _extends from '../../../@babel/runtime/helpers/esm/extends.js';

const[s,a]=E(),[c,l]=C(),[d,m]=E(),[f,p]=C();const DismissableLayer=/*#__PURE__*/React.forwardRef(((e,t)=>{const n=0===l(),r=/*#__PURE__*/React.createElement(v,_extends({},e,{ref:t}));return n?/*#__PURE__*/React.createElement(s,null,/*#__PURE__*/React.createElement(d,null,r)):r}));const v=/*#__PURE__*/React.forwardRef(((s,d)=>{const{disableOutsidePointerEvents:v=!1,onEscapeKeyDown:E,onPointerDownOutside:C,onFocusOutside:b,onInteractOutside:w,onDismiss:L,...P}=s,y=a(),D=l()+1,x=D===y,O=m(v),g=p()+(v?1:0),h=g<O;useBodyPointerEvents({disabled:v}),useEscapeKeydown((e=>{x&&(null==E||E(e),e.defaultPrevented||null==L||L());}));const{onPointerDownCapture:R}=function(e){const n=useCallbackRef(e),r=React.useRef(!1);return React.useEffect((()=>{const e=e=>{const t=e.target;if(t&&!r.current){const r=new CustomEvent("dismissableLayer.pointerDownOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});t.addEventListener("dismissableLayer.pointerDownOutside",n,{once:!0}),t.dispatchEvent(r);}r.current=!1;},t=window.setTimeout((()=>{document.addEventListener("pointerdown",e);}),0);return ()=>{window.clearTimeout(t),document.removeEventListener("pointerdown",e);}}),[n]),{onPointerDownCapture:()=>r.current=!0}}((e=>{h||(null==C||C(e),null==w||w(e),e.defaultPrevented||null==L||L());})),{onBlurCapture:T,onFocusCapture:F}=function(e){const n=useCallbackRef(e),r=React.useRef(!1);return React.useEffect((()=>{const e=e=>{const t=e.target;if(t&&!r.current){const r=new CustomEvent("dismissableLayer.focusOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});t.addEventListener("dismissableLayer.focusOutside",n,{once:!0}),t.dispatchEvent(r);}};return document.addEventListener("focusin",e),()=>document.removeEventListener("focusin",e)}),[n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}((e=>{null==b||b(e),null==w||w(e),e.defaultPrevented||null==L||L();})),B=O>0&&!h;return React.createElement(c,{runningCount:D},/*#__PURE__*/React.createElement(f,{runningCount:g},/*#__PURE__*/React.createElement(Primitive.div,_extends({},P,{ref:d,style:{pointerEvents:B?"auto":void 0,...P.style},onPointerDownCapture:composeEventHandlers(s.onPointerDownCapture,R),onBlurCapture:composeEventHandlers(s.onBlurCapture,T),onFocusCapture:composeEventHandlers(s.onFocusCapture,F)}))))}));function E(e){const t=/*#__PURE__*/React.createContext({total:0,setTotal:()=>{}}),n=({children:e})=>{const[n,r]=React.useState(0),o=React.useMemo((()=>({total:n,setTotal:r})),[n,r]);return React.createElement(t.Provider,{value:o},e)};return [n,function(e=!0){const{total:n,setTotal:r}=React.useContext(t);return React.useLayoutEffect((()=>{if(e)return r((e=>e+1)),()=>r((e=>e-1))}),[e,r]),n}]}function C(e){const t=/*#__PURE__*/React.createContext(0),n=e=>{const{children:n,runningCount:r}=e;return React.createElement(t.Provider,{value:r},n)};return [n,function(){return React.useContext(t)||0}]}

export { DismissableLayer };
