'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var index_module$1 = require('../../react-use-escape-keydown/dist/index.module.js');
var index_module$2 = require('../../react-use-callback-ref/dist/index.module.js');
var index_module = require('../../react-use-body-pointer-events/dist/index.module.js');
var index_module$3 = require('../../react-primitive/dist/index.module.js');
var index_module$4 = require('../../primitive/dist/index.module.js');
var React = require('react');
var _extends = require('../../../@babel/runtime/helpers/esm/extends.js');

function _interopNamespace(e) {
	if (e && e.__esModule) return e;
	var n = Object.create(null);
	if (e) {
		Object.keys(e).forEach(function (k) {
			if (k !== 'default') {
				var d = Object.getOwnPropertyDescriptor(e, k);
				Object.defineProperty(n, k, d.get ? d : {
					enumerable: true,
					get: function () {
						return e[k];
					}
				});
			}
		});
	}
	n['default'] = e;
	return Object.freeze(n);
}

var React__namespace = /*#__PURE__*/_interopNamespace(React);

const[s,a]=E(),[c,l]=C(),[d,m]=E(),[f,p]=C();const DismissableLayer=/*#__PURE__*/React__namespace.forwardRef(((e,t)=>{const n=0===l(),r=/*#__PURE__*/React__namespace.createElement(v,_extends['default']({},e,{ref:t}));return n?/*#__PURE__*/React__namespace.createElement(s,null,/*#__PURE__*/React__namespace.createElement(d,null,r)):r}));const v=/*#__PURE__*/React__namespace.forwardRef(((s,d)=>{const{disableOutsidePointerEvents:v=!1,onEscapeKeyDown:E,onPointerDownOutside:C,onFocusOutside:b,onInteractOutside:w,onDismiss:L,...P}=s,y=a(),D=l()+1,x=D===y,O=m(v),g=p()+(v?1:0),h=g<O;index_module.useBodyPointerEvents({disabled:v}),index_module$1.useEscapeKeydown((e=>{x&&(null==E||E(e),e.defaultPrevented||null==L||L());}));const{onPointerDownCapture:R}=function(e){const n=index_module$2.useCallbackRef(e),r=React__namespace.useRef(!1);return React__namespace.useEffect((()=>{const e=e=>{const t=e.target;if(t&&!r.current){const r=new CustomEvent("dismissableLayer.pointerDownOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});t.addEventListener("dismissableLayer.pointerDownOutside",n,{once:!0}),t.dispatchEvent(r);}r.current=!1;},t=window.setTimeout((()=>{document.addEventListener("pointerdown",e);}),0);return ()=>{window.clearTimeout(t),document.removeEventListener("pointerdown",e);}}),[n]),{onPointerDownCapture:()=>r.current=!0}}((e=>{h||(null==C||C(e),null==w||w(e),e.defaultPrevented||null==L||L());})),{onBlurCapture:T,onFocusCapture:F}=function(e){const n=index_module$2.useCallbackRef(e),r=React__namespace.useRef(!1);return React__namespace.useEffect((()=>{const e=e=>{const t=e.target;if(t&&!r.current){const r=new CustomEvent("dismissableLayer.focusOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});t.addEventListener("dismissableLayer.focusOutside",n,{once:!0}),t.dispatchEvent(r);}};return document.addEventListener("focusin",e),()=>document.removeEventListener("focusin",e)}),[n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}((e=>{null==b||b(e),null==w||w(e),e.defaultPrevented||null==L||L();})),B=O>0&&!h;return React__namespace.createElement(c,{runningCount:D},/*#__PURE__*/React__namespace.createElement(f,{runningCount:g},/*#__PURE__*/React__namespace.createElement(index_module$3.Primitive.div,_extends['default']({},P,{ref:d,style:{pointerEvents:B?"auto":void 0,...P.style},onPointerDownCapture:index_module$4.composeEventHandlers(s.onPointerDownCapture,R),onBlurCapture:index_module$4.composeEventHandlers(s.onBlurCapture,T),onFocusCapture:index_module$4.composeEventHandlers(s.onFocusCapture,F)}))))}));function E(e){const t=/*#__PURE__*/React__namespace.createContext({total:0,setTotal:()=>{}}),n=({children:e})=>{const[n,r]=React__namespace.useState(0),o=React__namespace.useMemo((()=>({total:n,setTotal:r})),[n,r]);return React__namespace.createElement(t.Provider,{value:o},e)};return [n,function(e=!0){const{total:n,setTotal:r}=React__namespace.useContext(t);return React__namespace.useLayoutEffect((()=>{if(e)return r((e=>e+1)),()=>r((e=>e-1))}),[e,r]),n}]}function C(e){const t=/*#__PURE__*/React__namespace.createContext(0),n=e=>{const{children:n,runningCount:r}=e;return React__namespace.createElement(t.Provider,{value:r},n)};return [n,function(){return React__namespace.useContext(t)||0}]}

exports.DismissableLayer = DismissableLayer;
