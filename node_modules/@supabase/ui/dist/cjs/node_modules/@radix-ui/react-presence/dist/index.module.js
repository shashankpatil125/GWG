'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var index_module = require('../../react-use-layout-effect/dist/index.module.js');
var index_module$1 = require('../../react-compose-refs/dist/index.module.js');
var React = require('react');

function _interopNamespace(e) {
	if (e && e.__esModule) return e;
	var n = Object.create(null);
	if (e) {
		Object.keys(e).forEach(function (k) {
			if (k !== 'default') {
				var d = Object.getOwnPropertyDescriptor(e, k);
				Object.defineProperty(n, k, d.get ? d : {
					enumerable: true,
					get: function () {
						return e[k];
					}
				});
			}
		});
	}
	n['default'] = e;
	return Object.freeze(n);
}

var React__namespace = /*#__PURE__*/_interopNamespace(React);

const Presence=u=>{const{present:o,children:s}=u,i=function(n){const[u,o]=React__namespace.useState(),s=React__namespace.useRef({}),i=React__namespace.useRef(n),c=React__namespace.useRef("none"),d=n?"mounted":"unmounted",[m,a]=function(e,n){return React__namespace.useReducer(((e,t)=>{const r=n[e][t];return null!=r?r:e}),e)}(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return React__namespace.useEffect((()=>{const e=r(s.current);c.current="mounted"===m?e:"none";}),[m]),index_module.useLayoutEffect((()=>{const e=s.current,t=i.current;if(t!==n){const u=c.current,o=r(e);if(n)a("MOUNT");else if("none"===o||"none"===(null==e?void 0:e.display))a("UNMOUNT");else {const e=u!==o;a(t&&e?"ANIMATION_OUT":"UNMOUNT");}i.current=n;}}),[n,a]),index_module.useLayoutEffect((()=>{if(u){const e=e=>{const n=r(s.current).includes(e.animationName);e.target===u&&n&&a("ANIMATION_END");};return u.addEventListener("animationcancel",e),u.addEventListener("animationend",e),()=>{u.removeEventListener("animationcancel",e),u.removeEventListener("animationend",e);}}}),[u,a]),{isPresent:["mounted","unmountSuspended"].includes(m),ref:React__namespace.useCallback((e=>{e&&(s.current=getComputedStyle(e)),o(e);}),[])}}(o),c="function"==typeof s?s({present:i.isPresent}):React__namespace.Children.only(s),d=index_module$1.useComposedRefs(i.ref,c.ref);return "function"==typeof s||i.isPresent?/*#__PURE__*/React__namespace.cloneElement(c,{ref:d}):null};function r(e){return (null==e?void 0:e.animationName)||"none"}Presence.displayName="Presence";

exports.Presence = Presence;
