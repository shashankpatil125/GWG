'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var index_module$2 = require('../../react-use-controllable-state/dist/index.module.js');
var index_module$3 = require('../../react-use-callback-ref/dist/index.module.js');
var index_module$4 = require('../../react-primitive/dist/index.module.js');
var index_module$6 = require('../../react-id/dist/index.module.js');
var index_module = require('../../react-context/dist/index.module.js');
var index_module$1 = require('../../react-compose-refs/dist/index.module.js');
var index_module$7 = require('../../react-collection/dist/index.module.js');
var index_module$5 = require('../../primitive/dist/index.module.js');
var React = require('react');
var _extends = require('../../../@babel/runtime/helpers/esm/extends.js');

function _interopNamespace(e) {
	if (e && e.__esModule) return e;
	var n = Object.create(null);
	if (e) {
		Object.keys(e).forEach(function (k) {
			if (k !== 'default') {
				var d = Object.getOwnPropertyDescriptor(e, k);
				Object.defineProperty(n, k, d.get ? d : {
					enumerable: true,
					get: function () {
						return e[k];
					}
				});
			}
		});
	}
	n['default'] = e;
	return Object.freeze(n);
}

var React__namespace = /*#__PURE__*/_interopNamespace(React);

const f={bubbles:!1,cancelable:!0},[l,m,p,d]=index_module$7.createCollection(),[v,g]=index_module.createContext("RovingFocusGroup");const RovingFocusGroup=/*#__PURE__*/React__namespace.forwardRef(((e,t)=>/*#__PURE__*/React__namespace.createElement(l,null,/*#__PURE__*/React__namespace.createElement(m,null,/*#__PURE__*/React__namespace.createElement(w,_extends['default']({},e,{ref:t}))))));const w=/*#__PURE__*/React__namespace.forwardRef(((o,n)=>{const{orientation:a,dir:l="ltr",loop:m=!1,currentTabStopId:p,defaultCurrentTabStopId:g,onCurrentTabStopIdChange:w,onEntryFocus:b,...F}=o,E=React__namespace.useRef(null),I=index_module$1.useComposedRefs(n,E),[R=null,h]=index_module$2.useControllableState({prop:p,defaultProp:g,onChange:w}),[T,A]=React__namespace.useState(!1),y=index_module$3.useCallbackRef(b),{getItems:D}=d(),S=React__namespace.useRef(!1);return React__namespace.useEffect((()=>{const e=E.current;if(e)return e.addEventListener("rovingFocusGroup.onEntryFocus",y),()=>e.removeEventListener("rovingFocusGroup.onEntryFocus",y)}),[y]),/*#__PURE__*/React__namespace.createElement(v,{orientation:a,dir:l,loop:m,currentTabStopId:R,onItemFocus:React__namespace.useCallback((e=>h(e)),[h]),onItemShiftTab:React__namespace.useCallback((()=>A(!0)),[])},/*#__PURE__*/React__namespace.createElement(index_module$4.Primitive.div,_extends['default']({tabIndex:T?-1:0,"aria-orientation":a,"data-orientation":a},F,{ref:I,style:{outline:"none",...o.style},onMouseDown:index_module$5.composeEventHandlers(o.onMouseDown,(()=>{S.current=!0;})),onFocus:index_module$5.composeEventHandlers(o.onFocus,(e=>{const t=!S.current;if(e.target===e.currentTarget&&t&&!T){const t=new Event("rovingFocusGroup.onEntryFocus",f);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=D().filter((e=>e.focusable));x([e.find((e=>e.active)),e.find((e=>e.id===R)),...e].filter(Boolean).map((e=>e.ref.current)));}}S.current=!1;})),onBlur:index_module$5.composeEventHandlers(o.onBlur,(()=>A(!1)))})))}));const RovingFocusItem=/*#__PURE__*/React__namespace.forwardRef(((e,t)=>{const{focusable:n=!0,active:i=!1,...a}=e,f=index_module$6.useId(),l=g("RovingFocusItem"),m=l.currentTabStopId===f,{getItems:v}=d();return React__namespace.createElement(p,{id:f,focusable:n,active:i},/*#__PURE__*/React__namespace.createElement(index_module$4.Primitive.span,_extends['default']({tabIndex:m?0:-1,"data-orientation":l.orientation},a,{ref:t,onMouseDown:index_module$5.composeEventHandlers(e.onMouseDown,(e=>{n?l.onItemFocus(f):e.preventDefault();})),onFocus:index_module$5.composeEventHandlers(e.onFocus,(()=>l.onItemFocus(f))),onKeyDown:index_module$5.composeEventHandlers(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void l.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,r){const o=function(e,t){return "rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,r);return "vertical"===t&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)?void 0:b[o]}(e,l.orientation,l.dir);if(void 0!==t){e.preventDefault();let n=v().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const i=n.indexOf(e.currentTarget);n=l.loop?(o=i+1,(r=n).map(((e,t)=>r[(o+t)%r.length]))):n.slice(i+1);}setTimeout((()=>x(n)));}var r,o;}))})))}));const b={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function x(e){const t=document.activeElement;for(const r of e){if(r===t)return;if(r.focus(),document.activeElement!==t)return}}

exports.RovingFocusGroup = RovingFocusGroup;
exports.RovingFocusItem = RovingFocusItem;
