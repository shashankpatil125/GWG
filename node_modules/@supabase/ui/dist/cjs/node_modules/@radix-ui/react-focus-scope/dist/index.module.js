'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var index_module = require('../../react-use-callback-ref/dist/index.module.js');
var index_module$2 = require('../../react-primitive/dist/index.module.js');
var index_module$1 = require('../../react-compose-refs/dist/index.module.js');
var React = require('react');
var _extends = require('../../../@babel/runtime/helpers/esm/extends.js');

function _interopNamespace(e) {
	if (e && e.__esModule) return e;
	var n = Object.create(null);
	if (e) {
		Object.keys(e).forEach(function (k) {
			if (k !== 'default') {
				var d = Object.getOwnPropertyDescriptor(e, k);
				Object.defineProperty(n, k, d.get ? d : {
					enumerable: true,
					get: function () {
						return e[k];
					}
				});
			}
		});
	}
	n['default'] = e;
	return Object.freeze(n);
}

var React__namespace = /*#__PURE__*/_interopNamespace(React);

const c={bubbles:!1,cancelable:!0};const FocusScope=/*#__PURE__*/React__namespace.forwardRef(((i,f)=>{const{loop:l=!1,trapped:m=!1,onMountAutoFocus:p,onUnmountAutoFocus:v,...E}=i,[F,S]=React__namespace.useState(null),b=index_module.useCallbackRef(p),T=index_module.useCallbackRef(v),y=React__namespace.useRef(null),L=index_module$1.useComposedRefs(f,(e=>S(e))),h=React__namespace.useRef({paused:!1,pause(){this.paused=!0;},resume(){this.paused=!1;}}).current;React__namespace.useEffect((()=>{if(m){function e(e){if(h.paused||!F)return;const t=e.target;F.contains(t)?y.current=t:a(y.current,{select:!0});}function t(e){!h.paused&&F&&(F.contains(e.relatedTarget)||a(y.current,{select:!0}));}return document.addEventListener("focusin",e),document.addEventListener("focusout",t),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t);}}}),[m,F,h.paused]),React__namespace.useEffect((()=>{if(F){d.add(h);const e=document.activeElement;if(!F.contains(e)){const t=new Event("focusScope.autoFocusOnMount",c);F.addEventListener("focusScope.autoFocusOnMount",b),F.dispatchEvent(t),t.defaultPrevented||(!function(e,{select:t=!1}={}){const n=document.activeElement;for(const o of e)if(a(o,{select:t}),document.activeElement!==n)return}(r(F),{select:!0}),document.activeElement===e&&a(F));}return ()=>{F.removeEventListener("focusScope.autoFocusOnMount",b),setTimeout((()=>{const t=new Event("focusScope.autoFocusOnUnmount",c);F.addEventListener("focusScope.autoFocusOnUnmount",T),F.dispatchEvent(t),t.defaultPrevented||a(null!=e?e:document.body,{select:!0}),F.removeEventListener("focusScope.autoFocusOnUnmount",T),d.remove(h);}),0);}}}),[F,b,T,h]);const x=React__namespace.useCallback((e=>{if(!l&&!m)return;if(h.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[o,u]=function(e){const t=r(e),n=s(t,e),o=s(t.reverse(),e);return [n,o]}(t);o&&u?e.shiftKey||n!==u?e.shiftKey&&n===o&&(e.preventDefault(),l&&a(u,{select:!0})):(e.preventDefault(),l&&a(o,{select:!0})):n===t&&e.preventDefault();}}),[l,m,h.paused]);return React__namespace.createElement(index_module$2.Primitive.div,_extends['default']({tabIndex:-1},E,{ref:L,onKeyDown:x}))}));function r(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function s(e,t){for(const n of e)if(!i(n,{upTo:t}))return n}function i(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return !0;for(;e;){if(void 0!==t&&e===t)return !1;if("none"===getComputedStyle(e).display)return !0;e=e.parentElement;}return !1}function a(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select();}}const d=function(){let e=[];return {add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=f(e,t),e.unshift(t);},remove(t){var n;e=f(e,t),null===(n=e[0])||void 0===n||n.resume();}}}();function f(e,t){const n=[...e],o=n.indexOf(t);return -1!==o&&n.splice(o,1),n}

exports.FocusScope = FocusScope;
